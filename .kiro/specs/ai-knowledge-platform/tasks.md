# 实施计划

## 任务清单

- [x] 1. 项目基础架构搭建
  - 创建Go项目结构，配置依赖管理和基础中间件
  - 设置PostgreSQL数据库连接和迁移系统
  - 配置Redis连接和基础缓存功能
  - 集成Swagger文档生成和API规范
  - _需求: 1.1, 1.2, 8.1_

- [x] 2. 数据库Schema初始化
  - [x] 2.1 创建核心数据表结构
    - 实现所有17个核心表的SQL迁移文件
    - 包含逻辑删除字段和时间戳字段
    - 创建必要的索引和约束
    - _需求: 14.1, 14.2_

  - [x] 2.2 实现数据库迁移系统
    - 集成golang-migrate或类似工具
    - 创建迁移脚本的版本管理
    - 实现数据库初始化和种子数据
    - _需求: 15.1_

- [x] 3. 认证与权限系统
  - [x] 3.1 实现JWT认证中间件
    - 创建JWT令牌生成和验证逻辑
    - 实现用户登录和令牌刷新接口
    - 添加认证中间件到Gin路由
    - _需求: 7.1, 7.2_

  - [x] 3.2 实现RBAC权限控制
    - 定义角色和权限常量
    - 创建权限检查中间件
    - 实现项目级权限隔离
    - _需求: 7.2, 14.5_

  - [x] 3.3 集成KMS密钥管理
    - 实现阿里云KMS客户端封装
    - 创建API密钥加密存储功能
    - 添加敏感配置的加密解密方法
    - _需求: 7.4, 13.5_

- [x] 4. 项目管理核心功能
  - [x] 4.1 实现项目CRUD接口
    - 创建项目创建、查询、更新、删除API
    - 实现项目数据隔离逻辑
    - 添加项目成员管理功能
    - _需求: 14.1, 14.2, 14.3, 14.5_

  - [x] 4.2 实现项目数据迁移功能
    - 创建项目间数据迁移API
    - 实现数据导出和导入逻辑
    - 添加迁移进度跟踪
    - _需求: 14.4_

- [x] 5. 文档处理系统
  - [x] 5.1 实现文件上传功能
    - 集成OSS/S3客户端
    - 创建文件上传API和元数据存储
    - 实现文件SHA256校验和去重
    - _需求: 1.1, 1.2, 1.3_

  - [x] 5.2 实现多格式文档解析器
    - 创建DocumentProcessor接口
    - 实现PDF、DOCX、Markdown、TXT、HTML解析器
    - 添加文档内容提取和清理功能
    - _需求: 2.1, 2.2, 2.3, 2.4, 2.5_

  - [x] 5.3 实现智能文本分块功能
    - 创建多种分块策略（固定长度、语义、结构、代码）
    - 实现分块配置和预览API
    - 添加分块结果的可视化接口
    - _需求: 2.6, 2.7, 2.8_

- [x] 6. 向量存储与检索系统
  - [x] 6.1 实现VectorProvider抽象接口
    - 定义向量存储的统一接口
    - 创建配置管理和提供商切换机制
    - 实现向量操作的基础方法
    - _需求: 9.1, 9.2_

  - [x] 6.2 实现ADB-PG向量适配器
    - 创建ADB-PG连接和配置管理
    - 实现向量索引创建和管理
    - 添加向量插入、查询、删除功能
    - _需求: 3.2, 3.3, 9.3_

  - [x] 6.3 集成Embedding API调用
    - 实现多厂商Embedding API适配器
    - 创建文本向量化处理流程
    - 添加向量生成的异步任务处理
    - _需求: 3.1, 3.4_

- [x] 7. LLM管理与调用系统
  - [x] 7.1 实现LLMProvider抽象接口
    - 定义LLM调用的统一接口
    - 支持OpenAI、Azure、千问、Claude等提供商
    - 实现流式和非流式文本生成
    - _需求: 13.1, 13.2_

  - [x] 7.2 实现LLM配置管理
    - 创建LLM提供商和模型的CRUD接口
    - 实现模型参数配置和连接测试
    - 添加模型可用性检查功能
    - _需求: 13.3, 13.4_

  - [x] 7.3 实现LLM调用监控
    - 添加LLM请求的指标收集
    - 实现调用频率限制和错误处理
    - 创建LLM使用统计和成本跟踪
    - _需求: 8.3_

- [ ] 8. RAG检索与查询功能
  - [ ] 8.1 实现基础向量检索
    - 创建查询向量化和相似度检索
    - 实现检索结果排序和过滤
    - 添加检索性能优化
    - _需求: 4.1, 4.2_

  - [ ] 8.2 实现高级检索功能
    - 添加重排序和CoT增强功能
    - 实现混合检索（向量+关键词）
    - 创建检索结果缓存机制
    - _需求: 4.3, 4.4_

  - [ ] 8.3 实现DeepSearch深度搜索
    - 创建查询意图分析和分解
    - 实现多跳推理和知识图谱增强
    - 添加查询重写和结果重排序
    - _需求: 12.1, 12.2, 12.3, 12.4_

- [ ] 9. 对话系统实现
  - [ ] 9.1 实现多轮对话管理
    - 创建对话会话和消息存储
    - 实现上下文维护和管理
    - 添加对话历史查询功能
    - _需求: 10.1, 10.4_

  - [ ] 9.2 实现RAG增强对话
    - 集成知识库检索到对话流程
    - 实现上下文相关的知识增强
    - 添加引用来源的追踪功能
    - _需求: 10.2_

  - [ ] 9.3 实现多模型对话支持
    - 支持对话中切换不同LLM模型
    - 实现模型特定的参数配置
    - 添加模型性能比较功能
    - _需求: 10.3_

- [ ] 10. Agent智能体系统
  - [ ] 10.1 实现Agent创建和管理
    - 创建Agent配置和角色定义
    - 实现Agent的知识库范围设置
    - 添加Agent行为参数配置
    - _需求: 11.1_

  - [ ] 10.2 实现Agent工具调用
    - 创建工具调用接口和注册机制
    - 实现知识检索和推理链组合
    - 添加工具执行结果的处理
    - _需求: 11.2_

  - [ ] 10.3 实现多Agent协作
    - 创建Agent间消息传递机制
    - 实现任务分发和协调功能
    - 添加Agent性能评估和监控
    - _需求: 11.3, 11.4_

- [ ] 11. 问题生成与答案系统
  - [ ] 11.1 实现智能问题生成
    - 创建基于文档分块的问题提取
    - 实现多样化问题类型生成
    - 添加问题标签和分类功能
    - _需求: 15.1, 15.2, 15.3_

  - [ ] 11.2 实现批量问题处理
    - 创建批量问题生成的异步任务
    - 实现问题生成进度跟踪
    - 添加提示词工程配置功能
    - _需求: 15.4, 15.5_

  - [ ] 11.3 实现答案生成系统
    - 创建基于问题的答案生成流程
    - 实现CoT思维链推理支持
    - 添加答案质量评估功能
    - _需求: 16.1, 16.2, 16.4_

  - [ ] 11.4 实现人工审核功能
    - 创建问题答案的审核界面
    - 实现审核状态管理和编辑功能
    - 添加质量控制和反馈机制
    - _需求: 16.3_

- [ ] 12. 数据集导出与训练
  - [ ] 12.1 实现数据集导出功能
    - 创建Alpaca和ShareGPT格式导出
    - 实现JSONL文件生成和OSS上传
    - 添加导出进度跟踪和通知
    - _需求: 5.1, 5.2, 5.3, 16.5_

  - [ ] 12.2 实现训练任务管理
    - 集成阿里百炼训练API调用
    - 创建训练配置YAML生成
    - 实现训练状态同步和跟踪
    - _需求: 6.1, 6.2, 6.3, 6.4_

- [ ] 13. 异步任务处理系统
  - [ ] 13.1 实现任务队列基础设施
    - 集成Redis和asynq任务队列
    - 创建任务定义和Worker接口
    - 实现任务状态跟踪和进度更新
    - _需求: 17.1, 17.5_

  - [ ] 13.2 实现各类异步Worker
    - 创建文档处理、问题生成、答案生成Worker
    - 实现数据蒸馏和向量索引Worker
    - 添加任务重试和错误处理机制
    - _需求: 17.2, 17.3, 17.4, 17.6_

  - [ ] 13.3 实现任务监控和管理
    - 创建任务状态查询和管理API
    - 实现任务队列监控和告警
    - 添加任务性能统计和优化
    - _需求: 17.7_

- [ ] 14. 监控与可观测性
  - [ ] 14.1 实现Prometheus指标收集
    - 添加业务指标和系统指标收集
    - 创建自定义指标和标签
    - 实现指标暴露端点
    - _需求: 8.1, 8.2_

  - [ ] 14.2 实现结构化日志系统
    - 集成logrus或zap日志库
    - 创建统一的日志格式和字段
    - 实现日志级别和输出配置
    - _需求: 8.2_

  - [ ] 14.3 实现链路追踪
    - 集成OpenTelemetry追踪
    - 添加HTTP请求和数据库操作追踪
    - 创建分布式追踪上下文传递
    - _需求: 8.2_

  - [ ] 14.4 配置告警规则
    - 创建Prometheus告警规则配置
    - 实现关键指标的阈值监控
    - 添加告警通知和处理流程
    - _需求: 8.3_

- [ ] 15. 前端应用开发
  - [ ] 15.1 搭建React项目基础
    - 创建React18 + TypeScript项目结构
    - 集成Ant Design 5.x和TailwindCSS
    - 配置路由和状态管理
    - _需求: 所有前端相关需求_

  - [ ] 15.2 实现项目管理界面
    - 创建项目列表、创建、编辑页面
    - 实现项目切换和成员管理
    - 添加项目设置和配置界面
    - _需求: 14.1-14.6_

  - [ ] 15.3 实现文档管理界面
    - 创建文件上传和列表展示
    - 实现文档预览和分块配置
    - 添加文档处理状态监控
    - _需求: 1.1-1.4, 2.1-2.8_

  - [ ] 15.4 实现对话和Agent界面
    - 创建对话界面和消息展示
    - 实现Agent创建和配置页面
    - 添加多轮对话和上下文管理
    - _需求: 10.1-10.4, 11.1-11.4_

  - [ ] 15.5 实现问题答案管理界面
    - 创建问题生成和审核界面
    - 实现答案编辑和质量评估
    - 添加数据集导出和训练管理
    - _需求: 15.1-15.5, 16.1-16.5_

- [ ] 16. 部署与运维
  - [ ] 16.1 创建Docker容器化配置
    - 编写多阶段Dockerfile
    - 创建docker-compose开发环境
    - 配置环境变量和配置管理
    - _需求: 所有部署相关需求_

  - [ ] 16.2 创建Kubernetes部署配置
    - 编写Helm Chart模板
    - 配置服务发现和负载均衡
    - 实现自动扩缩容和健康检查
    - _需求: 所有部署相关需求_

  - [ ] 16.3 配置CI/CD流水线
    - 创建GitHub Actions工作流
    - 实现自动化测试和构建
    - 配置自动部署和回滚机制
    - _需求: 所有部署相关需求_

- [ ] 17. 测试与质量保证
  - [ ] 17.1 编写单元测试
    - 为核心业务逻辑编写单元测试
    - 实现Mock外部依赖
    - 确保测试覆盖率达到80%以上
    - _需求: 所有功能需求_

  - [ ] 17.2 编写集成测试
    - 创建API接口集成测试
    - 实现数据库和外部服务测试
    - 添加端到端业务流程测试
    - _需求: 所有功能需求_

  - [ ] 17.3 性能测试与优化
    - 进行负载测试和压力测试
    - 优化数据库查询和缓存策略
    - 调优系统性能和资源使用
    - _需求: 所有性能相关需求_
